#!/bin/bash

#=================================================
# GENERIC STARTING
#=================================================
# MANAGE FAILURE OF THE SCRIPT
#=================================================

# Exit on command errors and treat unset variables as an error
set -eu

#=================================================
# IMPORT GENERIC HELPERS
#=================================================

if [ ! -e _common.sh ]; then
	# Get the _common.sh file if it's not in the current directory
	cp ../settings/scripts/_common.sh ./_common.sh
	chmod a+rx _common.sh
fi
source _common.sh
source /usr/share/yunohost/helpers

#=================================================
# LOAD SETTINGS
#=================================================

app=$YNH_APP_INSTANCE_NAME

domain=$(ynh_app_setting_get $app domain)

#=================================================
# STANDARD BACKUP STEPS
#=================================================
# BACKUP OF THE NGINX CONFIGURATION
#=================================================

ynh_backup "/etc/nginx/conf.d/$domain.d/$app.conf"

#=================================================
# SPECIFIC BACKUP
#=================================================
# BACKUP TRANSMISSION CONFIGURATION
#=================================================

ynh_backup "/etc/transmission-daemon/settings.json"

#=================================================
# BACKUP DATA
#=================================================

ynh_backup "/usr/share/transmission"
ynh_backup "/var/lib/transmission-daemon"

# The "--is big" parameter indicates that the file/directory requires "a lot of disk space"
# It won't be backed up before 'upgrade' or while doing a 'backup' with:
# "sudo BACKUP_CORE_ONLY=1 yunohost backup create --apps transmission"
# See https://yunohost.org/#/backup
ynh_backup --src_path="/home/yunohost.transmission" --is_big
